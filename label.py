import pandas as pd

def handle_label(x:pd.Series):
    id = int(x['id'])
    if id in [
            4, 9, 13, 15, 16, 17, 18, 19, 21, 23, 24, 25, 27, 28,
            30, 31, 33, 35, 36, 37, 40, 43, 44, 47, 50, 51, 56, 58,
            62, 67, 71, 72, 76, 83, 88, 90, 97, 98, 105, 107, 109, 110, 113, 114, 
            130, 132, 133, 134, 135, 136, 137, 140, 141, 142, 144, 146, 147, 148, 
            150, 152, 154, 156, 158, 159, 161, 162, 165, 169, 171, 172, 173, 177, 
            178, 179, 183, 184, 188, 194, 198, 200, 201, 205, 206, 207, 208, 209, 
            210, 212, 213, 218, 221, 222, 224, 226, 228, 229, 230, 231, 232, 235, 
            238, 239, 240, 242, 243, 244, 245, 246, 248, 249, 251, 252, 253, 257, 
            258, 259, 261, 262, 264, 269, 270, 272, 273, 276, 277, 278, 279, 280, 
            282, 286, 288, 289, 290, 291, 294, 295, 297, 298, 302, 303, 304, 305, 
            307, 310, 312, 313, 314, 318, 321, 322, 323, 324, 325, 327, 329, 335, 
            337, 344, 345, 350, 353, 355, 357, 358, 359, 360, 367, 378, 380, 383, 
            387, 388, 391, 392, 393, 394, 395, 397, 400, 402, 408, 409, 414, 415, 
            416, 417, 419, 425, 427, 428, 430, 433, 434, 435, 437, 439, 441, 442, 
            445, 448, 451, 454, 456, 457, 458, 460, 461, 465, 466, 467, 468, 470, 
            471, 473, 474, 475, 476, 477, 480, 482, 486, 487, 488, 490, 491, 497, 
            498, 499, 501, 502, 509, 513, 518, 521, 522, 523, 525, 526, 527, 528, 
            731, 734, 735, 736, 741, 742, 745, 747, 748, 751, 752, 753, 757, 758, 
            759, 760, 763, 764, 765, 768, 769, 770, 771, 773, 774, 775, 776, 778, 
            781, 782, 783, 784, 786, 788, 793, 795, 797, 798, 799, 802, 803, 805, 
            806, 807, 808, 810, 811, 812, 813, 815, 816, 818, 821, 822, 823, 825, 
            826, 827, 828, 830, 833, 834, 835, 837, 839, 840, 841, 843, 846, 847, 
            849, 850, 852, 853, 854, 855, 856, 857, 859, 861, 862, 864, 865, 867, 
            870, 871, 872, 874, 876, 879, 880, 884, 885, 893, 894, 899, 901, 904, 
            905, 906, 909, 910, 911, 912, 913, 917, 918, 920, 921, 923, 924, 927
        ]:
        return 0
    elif id in [
        11, 12, 78, 82, 89, 92, 93, 94, 103, 117, 121, 121, 189, 399,
        20, 138, 832, 851, 928,
        338, 356, 363,
        370, 
        453, 
        493, 
        529
    ]:
        return 1
    elif id in [
        41, 22, 320, 804, 842, 903, 908,
        503, 515, 516, 524,
        617, 
        175
    ]:
        return 2
    elif id in [
        122, 755, 766, 926, 929
    ]:
        return 3
    elif id in [
        621, 622
    ]:
        return 4
    elif id in [
        60, 61, 64, 65, 69, 70, 73, 74, 75, 77, 79, 
        80, 81, 85, 86, 87, 91, 96, 99, 100, 102, 104, 
        111, 112, 117, 119, 123, 38, 39, 1, 29, 139, 174, 
        217, 263, 266, 274, 328, 334, 346, 377, 386, 740
    ]:
        return 5
    elif id in [
        5, 301, 316, 343, 347, 369, 371, 373, 422, 423, 429, 
        489, 514, 519, 754, 817, 860, 891, 
        398, 443, 446, 447, 455, 443, 478, 508, 46, 106, 
        532, 761, 785, 800, 829, 824,
        342, 496, 629, 584, 739, 848, 915,
        538, 542, 550,
        385, 389, 404,
        3,
        84,
        396,
        869
    ]:
        return 6
    elif id in [
        225, 449, 483, 494, 512, 737, 738, 767,
        743
    ]:
        return 7
    elif id in [
        332, 333, 368, 66, 611, 794,
        361, 410, 411, 780
    ]:
        return 8
    elif id in [
        6, 7, 8, 10, 14, 26, 32, 45, 52, 53, 54, 
        55, 191, 199, 202, 211, 267, 283, 285, 296, 
        311, 418, 436, 462, 463, 572, 582, 729, 492, 
        620, 820, 881, 882
    ]:
        return 9
    elif id in [
        306, 309, 407, 34, 440, 749, 898, 875, 744, 762, 838
    ]:
        return 10
    elif id in [
        108, 131, 185, 186, 227, 233, 234, 256, 275, 281, 
        299, 405, 406, 431, 500, 667, 681,
        643, 656, 691, 726,
        534, 575,
        732, 877,
        733, 801
    ]:
        return 11
    elif id in [438, 730]:
        return 12
    elif id in [
        2, 166, 254, 315, 317, 479, 577, 626, 628, 632, 639, 661, 669
    ]:
        return 13
    elif id in [
        284, 308, 316, 319, 507, 648, 863
    ]:
        return 14
    elif id in [
        120, 49, 68, 168, 772, 796
    ]:
        return 15
    elif id in [
        348, 379, 746, 750
    ]:
        return 16
    elif id in [
        143, 157, 180
    ]:
        return  17
    elif id in [
        330, 536, 922
    ]:
        return 18
    elif id in [
        349, 352, 362,
        182, 203, 265, 413,
        381, 95, 779
    ]:
        return 19
    elif id in [
        645, 649
    ]:
        return 20
    elif id in [
        195, 214
    ]:
        return 21
    elif id in [
        149, 153, 155
    ]:
        return 22
    elif id in [
        116, 118, 831
    ]:
        return 23
    elif id in [
        576, 631, 652
    ]:
        return 24
    elif id in [
        593, 598
    ]:
        return 25
    elif id in [
        151, 170, 292, 339, 384, 424, 459, 485, 517, 520, 682, 710, 792, 845
    ]:
        return 26
    elif id in [
        791, 886, 887, 889, 890, 896, 925
    ]:
        return 27
    elif id in [
        160, 163, 167, 187, 190, 204
    ]:
        return 28
    elif id in [
        164, 181, 192, 203, 219, 220, 241
    ]:
        return 29
    elif id in [
        683, 684, 787, 789, 814, 873, 883, 886, 897, 912, 914, 916, 925
    ]:
        return 30
    elif id in [
        48, 63, 145, 382, 472
    ]:
        return 31
    elif id in [819, 866, 902]:
        return 32
    elif id in [59, 756, 809]:
        return 33
    elif id in [452, 481]:
        return 34
    elif id in [469, 505]:
        return 35
    elif id in [510, 511]:
        return 36
    elif id in [403, 444]:
        return 37
    elif id in [354, 364]:
        return 38
    elif id in [919, 928]:
        return 39
    
'''
def handle_label_str(x:pd.Series):
    id = int(x['id'])
    if id in [
            4, 9, 13, 15, 16, 17, 18, 19, 21, 23, 24, 25, 27, 28,
            30, 31, 33, 35, 36, 37, 40, 43, 44, 47, 50, 51, 56, 58,
            62, 67, 71, 72, 76, 83, 88, 90, 97, 98, 105, 107, 109, 110, 113, 114
        ]:
        return '不涉华数据'
    elif id in [
        60, 61, 64, 65, 69, 70, 73, 74, 75, 77, 79, 80, 81, 85, 86, 87, 91,
        96, 99, 100, 102, 104, 111, 112, 117, 119, 123, 38, 39, 1, 29
    ]:
        return '美国的亚裔歧视'
    elif id in [
        11, 12, 78, 82, 89, 92, 93, 94, 103, 117, 121
    ]:
        return '中美Alaska会谈'
    elif id in [
        6, 7, 8, 10, 14, 26, 32, 45, 52, 53, 54, 55
    ]:
        return '新疆人权问题'
    elif id in [116, 118]:
        return '中国的非洲人不公正对待'
    elif id in [106, 46]:
        return '疫苗外交关系'
    elif id == 115:
        return '拼多多'
    elif id in [48, 63]:
        return '特斯拉'
    elif id in [120, 49, 68]:
        return '加拿大间谍'
    elif id in [3, 5, 84]:
        return 'COVID-19'
    elif id in [41, 22]:
        return '中美贸易/贸易战'
    elif id == 108:
        return '香港立法问题'
    elif id == 122:
        return '中国与美国大选'
    elif id == 66:
        return '南海问题'
    elif id == 95:
        return '中国政府数据监控'
    elif id == 101:
        return '网络安全对抗'
    elif id == 34:
        return '台海问题'
    elif id == 42:
        return '腾讯'
    elif id == 59:
        return '环境保护（中国part）'
    elif id == 20:
        return '中美将展开竞争'
    elif id == 2:
        return '中澳贸易战'
    elif id == 0:
        return '针对中国的民调'
'''

def handle_label_str(x:pd.Series):
    id = int(x['id'])
    if id in [
            4, 9, 13, 15, 16, 17, 18, 19, 21, 23, 24, 25, 27, 28,
            30, 31, 33, 35, 36, 37, 40, 43, 44, 47, 50, 51, 56, 58,
            62, 67, 71, 72, 76, 83, 88, 90, 97, 98, 105, 107, 109, 110, 113, 114, 
            130, 132, 133, 134, 135, 136, 137, 140, 141, 142, 144, 146, 147, 148, 
            150, 152, 154, 156, 158, 159, 161, 162, 165, 169, 171, 172, 173, 177, 
            178, 179, 183, 184, 188, 194, 198, 200, 201, 205, 206, 207, 208, 209, 
            210, 212, 213, 218, 221, 222, 224, 226, 228, 229, 230, 231, 232, 235, 
            238, 239, 240, 242, 243, 244, 245, 246, 248, 249, 251, 252, 253, 257, 
            258, 259, 261, 262, 264, 269, 270, 272, 273, 276, 277, 278, 279, 280, 
            282, 286, 288, 289, 290, 291, 294, 295, 297, 298, 302, 303, 304, 305, 
            307, 310, 312, 313, 314, 318, 321, 322, 323, 324, 325, 327, 329, 335, 
            337, 344, 345, 350, 353, 355, 357, 358, 359, 360, 367, 378, 380, 383, 
            387, 388, 391, 392, 393, 394, 395, 397, 400, 402, 408, 409, 414, 415, 
            416, 417, 419, 425, 427, 428, 430, 433, 434, 435, 437, 439, 441, 442, 
            445, 448, 451, 454, 456, 457, 458, 460, 461, 465, 466, 467, 468, 470, 
            471, 473, 474, 475, 476, 477, 480, 482, 486, 487, 488, 490, 491, 497, 
            498, 499, 501, 502, 509, 513, 518, 521, 522, 523, 525, 526, 527, 528, 
            731, 734, 735, 736, 741, 742, 745, 747, 748, 751, 752, 753, 757, 758, 
            759, 760, 763, 764, 765, 768, 769, 770, 771, 773, 774, 775, 776, 778, 
            781, 782, 783, 784, 786, 788, 793, 795, 797, 798, 799, 802, 803, 805, 
            806, 807, 808, 810, 811, 812, 813, 815, 816, 818, 821, 822, 823, 825, 
            826, 827, 828, 830, 833, 834, 835, 837, 839, 840, 841, 843, 846, 847, 
            849, 850, 852, 853, 854, 855, 856, 857, 859, 861, 862, 864, 865, 867, 
            870, 871, 872, 874, 876, 879, 880, 884, 885, 893, 894, 899, 901, 904, 
            905, 906, 909, 910, 911, 912, 913, 917, 918, 920, 921, 923, 924, 927
        ]:
        return '不涉华数据'
    elif id in [
        11, 12, 78, 82, 89, 92, 93, 94, 103, 117, 121, 121, 189, 399,
        20, 138, 832, 851, 928,
        338, 356, 363,
        370, 
        453, 
        493, 
        529
    ]:
        return '中美关系'
    elif id in [
        41, 22, 320, 804, 842, 903, 908,
        503, 515, 516, 524,
        617, 
        175
    ]:
        return '中美贸易/贸易战'
    elif id in [
        122, 755, 766, 926, 929
    ]:
        return '中国与美国大选'
    elif id in [
        621, 622
    ]:
        return '美国限制中国共产党成员的旅游限制'
    elif id in [
        60, 61, 64, 65, 69, 70, 73, 74, 75, 77, 79, 
        80, 81, 85, 86, 87, 91, 96, 99, 100, 102, 104, 
        111, 112, 117, 119, 123, 38, 39, 1, 29, 139, 174, 
        217, 263, 266, 274, 328, 334, 346, 377, 386, 740
    ]:
        return '美国的亚裔歧视'
    elif id in [
        5, 301, 316, 343, 347, 369, 371, 373, 422, 423, 429, 
        489, 514, 519, 754, 817, 860, 891, 
        398, 443, 446, 447, 455, 443, 478, 508, 46, 106, 
        532, 761, 785, 800, 829, 824,
        342, 496, 629, 584, 739, 848, 915,
        538, 542, 550,
        385, 389, 404,
        3,
        84,
        396,
        869
    ]:
        return 'COVID19'
    elif id in [
        225, 449, 483, 494, 512, 737, 738, 767,
        743
    ]:
        return '疫情以来中国经济迅速恢复'
    elif id in [
        332, 333, 368, 66, 611, 794,
        361, 410, 411, 780
    ]:
        return '中美海洋问题'
    elif id in [
        6, 7, 8, 10, 14, 26, 32, 45, 52, 53, 54, 
        55, 191, 199, 202, 211, 267, 283, 285, 296, 
        311, 418, 436, 462, 463, 572, 582, 729, 492, 
        620, 820, 881, 882
    ]:
        return '新疆人权（民族主义）/新疆棉问题'
    elif id in [
        306, 309, 407, 34, 440, 749, 898, 875, 744, 762, 838
    ]:
        return '台湾问题'
    elif id in [
        108, 131, 185, 186, 227, 233, 234, 256, 275, 281, 
        299, 405, 406, 431, 500, 667, 681,
        643, 656, 691, 726,
        534, 575,
        732, 877,
        733, 801
    ]:
        return '香港问题'
    elif id in [438, 730]:
        return '西藏问题'
    elif id in [
        2, 166, 254, 315, 317, 479, 577, 626, 628, 632, 639, 661, 669
    ]:
        return '中澳关系恶化/中澳贸易战'
    elif id in [
        284, 308, 316, 319, 507, 648, 863
    ]:
        return '中印边界冲突'
    elif id in [
        120, 49, 68, 168, 772, 796
    ]:
        return '加拿大间谍/中加关系'
    elif id in [
        348, 379, 746, 750
    ]:
        return '朝鲜问题'
    elif id in [
        143, 157, 180
    ]:
        return  '缅甸政变与中国'
    elif id in [
        330, 536, 922
    ]:
        return '中欧关系'
    elif id in [
        349, 352, 362,
        182, 203, 265, 413,
        381, 95, 779
    ]:
        return '中国互联网内容监管'
    elif id in [
        645, 649
    ]:
        return '中国拟出台新规“禁止极端宗教主义”'
    elif id in [
        195, 214
    ]:
        return '中国扩充军备'
    elif id in [
        149, 153, 155
    ]:
        return '中国的污染问题'
    elif id in [
        116, 118, 831
    ]:
        return '中国的非洲人不公正对待'
    elif id in [
        576, 631, 652
    ]:
        return '中国嫦娥五号月球探测器成功向地球传送月球样本'
    elif id in [
        593, 598
    ]:
        return '中国国有企业陷入困境, 这可能印象全球经济复苏'
    elif id in [
        151, 170, 292, 339, 384, 424, 459, 485, 517, 520, 682, 710, 792, 845
    ]:
        return '马云与阿里巴巴被约谈；阿里巴巴被反垄断调查'
    elif id in [
        791, 886, 887, 889, 890, 896, 925
    ]:
        return '微信'
    elif id in [
        160, 163, 167, 187, 190, 204
    ]:
        return 'QUAD'
    elif id in [
        164, 181, 192, 203, 219, 220, 241
    ]:
        return '微软受到黑客攻击'
    elif id in [
        683, 684, 787, 789, 814, 873, 883, 886, 897, 912, 914, 916, 925
    ]:
        return 'Tiktok事件'
    elif id in [
        48, 63, 145, 382, 472
    ]:
        return '中国可能监管特斯拉/特斯拉在中国'
    elif id in [819, 866, 902]:
        return '外企'
    elif id in [59, 756, 809]:
        return '中国环境保护'
    elif id in [452, 481]:
        return '中国矿工被困'
    elif id in [469, 505]:
        return '腾讯Baidu吉利联手开发智能车'
    elif id in [510, 511]:
        return '美国麻将游戏抹除中国文化元素'
    elif id in [403, 444]:
        return '快手股票大涨'
    elif id in [354, 364]:
        return '中国生肖与春节 牛年 历史文化'
    elif id in [919, 928]:
        return '冬奥会'

def date_handler(x:pd.Series):
    date = x['date']
    date = date.isocalendar()
    return date

df = pd.read_excel('./cnn.xlsx')
df['date'] = pd.to_datetime(df['date'])
df['date_calendar'] = df.apply(date_handler, axis=1)
df['label'] = df.apply(handle_label, axis=1)
df['label_str'] = df.apply(handle_label_str, axis=1)
df = df[df['value'].notna()]
df = df[df['label'].notna()]
df = df[df['label'] > 0]

df.to_excel('./cnn_labeled_all.xlsx', index=False)